<script>
  document.addEventListener("DOMContentLoaded", function() {
    // Função para normalizar o fragmento: lowercase e remoção de "?" 
    // (adicione outras remoções se necessário)
    function normalizeFragment(fragment) {
      return fragment.toLowerCase().replace(/\?/g, "");
    }

    // Atualiza os links internos: ajusta os atributos href e data-href
    var links = document.querySelectorAll("a.internal-link");
    links.forEach(function(link) {
      function updateAttr(attrName) {
        var value = link.getAttribute(attrName);
        if (value && value.indexOf("#") !== -1) {
          var parts = value.split("#");
          var fragment = parts[1];
          var normalized = normalizeFragment(fragment);
          if (fragment !== normalized) {
            link.setAttribute(attrName, parts[0] + "#" + normalized);
          }
        }
      }
      updateAttr("href");
      updateAttr("data-href");
    });

    // Ao carregar a página, se houver um fragmento na URL, tenta encontrar o elemento correspondente.
    if (window.location.hash) {
      // Obtém o hash (sem o "#")
      var rawHash = window.location.hash.substring(1);
      // Normaliza o hash para que seja compatível com o id gerado
      var normalizedHash = normalizeFragment(rawHash);
      var target = document.getElementById(normalizedHash);
      if (target) {
        // Caso o elemento seja encontrado, rola até ele de forma suave
        target.scrollIntoView({behavior: "smooth"});
      }
    }
  });
</script>